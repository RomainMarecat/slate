<div class="container">
  <div class="row">
    <div class="col">
      <form [formGroup]="form"
            (ngSubmit)="saveDocument()"
            class="form">
        <mat-card class="mat-card mt-3">
          <mat-card-content class="mat-card-content"
                            fxLayout="column wrap"
                            fxLayoutAlign="start center">

            <mat-form-field class="mat-form-field">
              <input matInput
                     maxlength="100"
                     [placeholder]="'admin.placeholder.recipe.creator'|translate"
                     formControlName="creator">
              <mat-hint align="end">{{ form.get('creator').value.length }} {{ '/100'|translate }}</mat-hint>
              <mat-error *ngIf="form.get('creator').invalid && form.get('creator').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.creator'|translate"></mat-error>
              <mat-error *ngIf="form.get('creator').invalid && form.get('creator').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.creator'|translate"></mat-error>
            </mat-form-field>

            <mat-form-field class="mat-form-field">
              <input matInput
                     maxlength="100"
                     [placeholder]="'admin.placeholder.recipe.author'|translate"
                     formControlName="author">
              <mat-hint align="end">{{ form.get('author').value.length }} {{ '/100'|translate }}</mat-hint>
              <mat-error *ngIf="form.get('author').invalid && form.get('author').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.author'|translate"></mat-error>
              <mat-error *ngIf="form.get('author').invalid && form.get('author').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.author'|translate"></mat-error>
            </mat-form-field>

            <mat-radio-group class="mt-4"
                             formControlName="on_homepage"
                             fxLayout="row"
                             fxLayoutAlign="center stretch"
                             fxLayoutGap="20px"
                             fxLayout.xs="column"
                             fxLayoutAlign.xs="start stretch"
                             fxLayoutGap.xs="10px">
              <mat-radio-button [value]="true">
                {{ 'admin.label.recipe.on_homepage.true'|translate }}
              </mat-radio-button>
              <mat-radio-button [value]="false">
                {{ 'admin.label.recipe.on_homepage.false'|translate }}
              </mat-radio-button>
            </mat-radio-group>


            <mat-form-field class="mat-form-field">
              <input matInput
                     maxlength="100"
                     [placeholder]="'admin.placeholder.recipe.name'|translate"
                     formControlName="name">
              <mat-hint align="end">{{ form.get('name').value.length }} {{ '/100'|translate }}</mat-hint>
              <mat-error *ngIf="form.get('name').invalid && form.get('name').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.name'|translate"></mat-error>
              <mat-error *ngIf="form.get('name').invalid && form.get('name').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.name'|translate"></mat-error>
            </mat-form-field>

            <!-- Cuisine Type -->
            <mat-form-field class="mat-form-field">
              <mat-select formControlName="cuisine_type"
                          [placeholder]="'admin.placeholder.recipe.cuisine_type'|translate">
                <mat-option [value]="'admin.option.base'|translate">
                  {{ 'admin.option.base' | translate }}
                </mat-option>
                <mat-option [value]="'admin.option.starter'|translate">
                  {{ 'admin.option.starter' | translate }}
                </mat-option>
                <mat-option [value]="'admin.option.dish'|translate">
                  {{ 'admin.option.dish' | translate }}
                </mat-option>
                <mat-option [value]="'admin.option.dessert'|translate">
                  {{ 'admin.option.dessert' | translate }}
                </mat-option>
              </mat-select>

              <mat-error *ngIf="form.get('cuisine_type').invalid && form.get('cuisine_type').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.cuisine_type'|translate"></mat-error>
              <mat-error *ngIf="form.get('cuisine_type').invalid && form.get('cuisine_type').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.cuisine_type'|translate"></mat-error>
            </mat-form-field>


            <mat-form-field>
              <input matInput
                     [(colorPicker)]="color"
                     [cpPosition]="'bottom'"
                     [style.background-color]="color"
                     [placeholder]="'admin.placeholder.recipe.color'|translate"
                     formControlName="color">
              <mat-error *ngIf="form.get('color').invalid && form.get('color').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.color'|translate"></mat-error>
              <mat-error *ngIf="form.get('color').invalid && form.get('color').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.color'|translate"></mat-error>
            </mat-form-field>

            <div class="mt-2 block-image"
                 fxLayout="row"
                 fxLayoutAlign="center stretch"
                 fxLayoutGap="20px">
              <app-storage-upload [folder]="'articles'"
                                  [displayDownloadUrl]="false"
                                  [media]="form.get('image').value"
                                  [metadata]="imageStorageConfig"
                                  (imageChanged)="onImageChange($event)"
                                  (imageRefChanged)="onImageRefChanged($event)">
              </app-storage-upload>
            </div>


            <mat-form-field class="mat-form-field">
              <input matInput
                     type="number"
                     min="1"
                     [placeholder]="'admin.placeholder.recipe.yield'|translate"
                     formControlName="yield">
              <mat-error *ngIf="form.get('yield').invalid && form.get('yield').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.yield'|translate"></mat-error>
              <mat-error *ngIf="form.get('yield').invalid && form.get('yield').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.yield'|translate"></mat-error>
            </mat-form-field>


            <div fxLayout="row wrap"
                 fxLayoutAlign="space-around stretch">
              <mat-form-field class="mat-form-field"
                              fxFlex="45">
                <input matInput
                       type="time"
                       maxlength="100"
                       [placeholder]="'admin.placeholder.recipe.cook_time'|translate"
                       [formControl]="form.get('cook_time')">
                <mat-error *ngIf="form.get('cook_time').invalid && form.get('cook_time').value.length === 0"
                           [innerHtml]="'admin.error.required.recipe.cook_time'|translate"></mat-error>
                <mat-error *ngIf="form.get('cook_time').invalid && form.get('cook_time').value.length > 0"
                           [innerHtml]="'admin.error.invalid.recipe.cook_time'|translate"></mat-error>
              </mat-form-field>

              <mat-form-field class="mat-form-field"
                              fxFlex="45">
                <input matInput
                       type="time"
                       maxlength="100"
                       [placeholder]="'admin.placeholder.recipe.prep_time'|translate"
                       [formControl]="form.get('prep_time')">
                <mat-error *ngIf="form.get('prep_time').invalid && form.get('prep_time').value.length === 0"
                           [innerHtml]="'admin.error.required.recipe.prep_time'|translate"></mat-error>
                <mat-error *ngIf="form.get('prep_time').invalid && form.get('prep_time').value.length > 0"
                           [innerHtml]="'admin.error.invalid.recipe.prep_time'|translate"></mat-error>
              </mat-form-field>

              <mat-form-field class="mat-form-field"
                              fxFlex="45">
                <input matInput
                       type="time"
                       maxlength="100"
                       [placeholder]="'admin.placeholder.recipe.waiting_time'|translate"
                       [formControl]="form.get('waiting_time')">
                <mat-error *ngIf="form.get('waiting_time').invalid && form.get('waiting_time').value.length === 0"
                           [innerHtml]="'admin.error.required.recipe.waiting_time'|translate"></mat-error>
                <mat-error *ngIf="form.get('waiting_time').invalid && form.get('waiting_time').value.length > 0"
                           [innerHtml]="'admin.error.invalid.recipe.waiting_time'|translate"></mat-error>
              </mat-form-field>

              <mat-form-field class="mat-form-field"
                              fxFlex="45">
                <input matInput
                       type="time"
                       maxlength="100"
                       [placeholder]="'admin.placeholder.recipe.total_time'|translate"
                       [formControl]="form.get('total_time')">
                <mat-error *ngIf="form.get('total_time').invalid && form.get('total_time').value.length === 0"
                           [innerHtml]="'admin.error.required.recipe.total_time'|translate"></mat-error>
                <mat-error *ngIf="form.get('total_time').invalid && form.get('total_time').value.length > 0"
                           [innerHtml]="'admin.error.invalid.recipe.total_time'|translate"></mat-error>
              </mat-form-field>

            </div>

            <mat-form-field class="mat-form-field">
              <input matInput
                     type="number"
                     min="1"
                     max="5"
                     [placeholder]="'admin.placeholder.recipe.difficulty'|translate"
                     formControlName="difficulty">
              <mat-error *ngIf="form.get('difficulty').invalid && form.get('difficulty').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.difficulty'|translate"></mat-error>
              <mat-error *ngIf="form.get('difficulty').invalid && form.get('difficulty').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.difficulty'|translate"></mat-error>
            </mat-form-field>

            <!-- Trick -->
            <mat-form-field class="mat-form-field">
              <input matInput
                     [placeholder]="'admin.placeholder.recipe.trick'|translate"
                     formControlName="trick">
              <mat-error *ngIf="form.get('trick').invalid && form.get('trick').value.length === 0"
                         [innerHtml]="'admin.error.required.recipe.trick'|translate"></mat-error>
              <mat-error *ngIf="form.get('trick').invalid && form.get('trick').value.length > 0"
                         [innerHtml]="'admin.error.invalid.recipe.trick'|translate"></mat-error>
            </mat-form-field>


            <div formArrayName="ingredients"
                 class="ingredients-wrapper mt-2"
                 *ngIf="form.get('ingredients') && form.get('ingredients')?.controls">
              <div class="ingredients-header-wrapper"
                   fxLayout="row"
                   fxLayoutAlign="space-around center"
                   fxLayout.xs="row wrap"
                   fxLayoutAlign.xs="center center">
                <p class="mb-0 text-center"
                   fxFlex="50"
                   fxFlex.xs="80">
                  {{ 'admin.label.recipe.ingredients.title'|translate }}
                </p>
                <app-admin-recipe-ingredient-list fxFlex="50"
                                                  fxFlex.xs="80"
                                                  (ingredientSelected)="onIngredientSelected($event)">
                </app-admin-recipe-ingredient-list>
                <button type="button"
                        mat-icon-button
                        class="button-add-ingredient"
                        [attr.role]="'cta.add'|translate"
                        (click)="addIngredient(selectedIngredient)"
                        fxFlex="10">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
              <mat-list>
                <app-admin-recipe-ingredient-edit [recipe]="document"
                                                  [form]="ingredient"
                                                  (removed)="removeIngredient(i)"
                                                  *ngFor="let ingredient of form.get('ingredients').controls; let i = index">
                </app-admin-recipe-ingredient-edit>
              </mat-list>
            </div>

            <div formArrayName="preparations"
                 class="preparations-wrapper mt-2"
                 *ngIf="form.get('preparations') && form.get('preparations')?.controls">
              <div class="preparations-header-wrapper"
                   fxLayout="row"
                   fxLayoutAlign="space-around center"
                   fxLayout.xs="row"
                   fxLayoutAlign.xs="center center">
                <p class="mb-0">{{ 'admin.label.recipe.preparations.title'|translate }}</p>
                <button type="button"
                        mat-icon-button
                        class="button-add-preparation"
                        [attr.role]="'cta.add'|translate"
                        (click)="addPreparation()">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
              <mat-list>
                <app-admin-recipe-preparation-edit [form]="preparation"
                                                   (removed)="removePreparation(i)"
                                                   [ingredients]="form.get('ingredients').value"
                                                   *ngFor="let preparation of form.get('preparations').controls; let i = index">
                </app-admin-recipe-preparation-edit>
              </mat-list>
            </div>

            <div formArrayName="instructions"
                 class="instructions-wrapper mt-2"
                 *ngIf="form.get('instructions') && form.get('instructions')?.controls">
              <div class="instructions-header-wrapper"
                   fxLayout="row"
                   fxLayoutAlign="space-around center"
                   fxLayout.xs="row"
                   fxLayoutAlign.xs="center center">
                <p class="mb-0">{{ 'admin.label.recipe.instructions.title'|translate }}</p>
                <button type="button"
                        mat-icon-button
                        class="button-add-instruction"
                        [attr.role]="'cta.add'|translate"
                        (click)="addInstruction()">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
              <mat-list cdkDropList
                        (cdkDropListDropped)="drop($event)"
                        [cdkDropListData]="form.get('instructions').controls">
                <app-admin-recipe-instruction-edit cdkDrag
                                                   [form]="instruction"
                                                   [ingredients]="form.get('ingredients').value"
                                                   (removed)="removeInstruction(i)"
                                                   *ngFor="let instruction of form.get('instructions').controls; let i = index">
                </app-admin-recipe-instruction-edit>
              </mat-list>

            </div>

            <div>

              <div class="associated-recipes-header-wrapper"
                   fxLayout="row"
                   fxLayoutAlign="space-around center"
                   fxLayout.xs="row"
                   fxLayoutAlign.xs="center center">
                <p class="mb-0">{{ 'admin.label.recipe.associated-recipes.title'|translate }}</p>
                <button type="button"
                        mat-icon-button
                        class="button-add-associated-recipe"
                        [attr.role]="'cta.add'|translate"
                        (click)="addAssociatedRecipe()">
                  <mat-icon>add</mat-icon>
                </button>
              </div>

              <app-admin-recipe-associated *ngIf="showAssociatedRecipes"
                                           [recipe]="document"
                                           [form]="form.get('associated_recipes')"
                                           (removed)="removeAssociatedRecipe(i)">
              </app-admin-recipe-associated>
            </div>

          </mat-card-content>

          <mat-card-actions>
            <div class="d-flex justify-content-around">
              <button type="button"
                      class="back text-uppercase"
                      mat-raised-button
                      role="button"
                      [attr.aria-label]="'cta.cancel'|translate"
                      (click)="cancel()">
                {{ 'cta.cancel'|translate }}
              </button>
              <button type="submit"
                      class="validate text-uppercase"
                      mat-raised-button
                      role="button"
                      [disabled]="form.invalid"
                      [attr.aria-label]="'cta.save'|translate"
                      [color]="form.valid ? 'primary' : ''">
                {{ 'cta.save'|translate }}
              </button>
            </div>
          </mat-card-actions>
        </mat-card>
      </form>
    </div>
  </div>
</div>
